import Head from "next/head";
import Image from "next/image";
import { useEffect, useState } from "react";
import Main from "../src/components/Main/Main";
import arrow from "../src/images/icons8-freccia.webp";
import { goUp, goDown } from "../src/utils/SlidesUtils";
import Contacts from "../src/components/Contact/Contacts";
import Projects from "../src/components/Projects/Projects";
import { ToastContainer } from "react-toastify";
import "react-toastify/dist/ReactToastify.css";
import contentfulClient from "../src/client/ContentfulClient";
import { mapProjects } from "../src/utils/ProjectUtils";
import { Project } from "../src/types/Project";
import Arrow from "../src/components/Arrow/Arrow";
import projectIcon from "../src/images/icons8-projects.webp";
import contactIcon from "../src/images/icons8-contacts.webp";

export async function getStaticProps() {
  const contentfulProjects = await contentfulClient
    .getEntries("project")
    .then((res) => res.items);
  const projects = mapProjects(contentfulProjects);
  return { props: { projects } };
}

export default function Home(props: { projects: Project[] }) {
  const [mainClass, setMainClass] = useState("active");
  const [projectsClass, setProjectsClass] = useState("up");
  const [contactsClass, setContactsClass] = useState("down");
  const [hideTop, setHideTop] = useState(false);
  const [hideBottom, setHideBottom] = useState(false);

  useEffect(() => {
    projectsClass === "active" ? setHideTop(true) : setHideTop(false);
  }, [projectsClass]);

  useEffect(() => {
    contactsClass === "active" ? setHideBottom(true) : setHideBottom(false);
  }, [contactsClass]);

  return (
    <div className="index">
      <Head>
        <title>JM</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <Arrow
        icon={projectIcon}
        hide={hideTop}
        mainClass={mainClass}
        arrowClass="arrow_up"
        direction={goUp}
        setContactsClass={setContactsClass}
        setMainClass={setMainClass}
        setProjectsClass={setProjectsClass}
      />

      <Main />
      <Contacts contactsClass={contactsClass} />
      <Projects projectsClass={projectsClass} projects={props.projects} />

      <Arrow
        hide={hideBottom}
        arrowClass="arrow_down"
        icon={contactIcon}
        mainClass={mainClass}
        direction={goDown}
        setContactsClass={setContactsClass}
        setMainClass={setMainClass}
        setProjectsClass={setProjectsClass}
      />

      <ToastContainer
        position="top-right"
        autoClose={5000}
        hideProgressBar={false}
        newestOnTop={false}
        closeOnClick
        rtl={false}
        pauseOnFocusLoss
        draggable
        pauseOnHover
        theme="dark"
      />
    </div>
  );
}
